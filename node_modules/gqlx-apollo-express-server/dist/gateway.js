"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGateway = void 0;
const graphql_1 = require("graphql");
const events_1 = require("events");
const UPDATE_SCHEMA_EVENT = 'schema-update';
function createGateway({ get: getSchema, onUpdate }) {
    const eventEmitter = new events_1.EventEmitter();
    const executor = args => (0, graphql_1.execute)(Object.assign(Object.assign({}, args), { schema: getSchema(), contextValue: args.context, variableValues: args.request.variables }));
    onUpdate((newSchema) => eventEmitter.emit(UPDATE_SCHEMA_EVENT, newSchema));
    return {
        load: () => Promise.resolve({
            schema: getSchema(),
            executor,
        }),
        onSchemaChange: callback => {
            eventEmitter.on(UPDATE_SCHEMA_EVENT, callback);
            return () => eventEmitter.removeListener(UPDATE_SCHEMA_EVENT, callback);
        },
        executor,
    };
}
exports.createGateway = createGateway;
//# sourceMappingURL=gateway.js.map